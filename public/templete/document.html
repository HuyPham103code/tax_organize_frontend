<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/question.css">
    <link rel="stylesheet" href="../css/upload_document.css">
    <title>information form</title>
    <style>
        .active {
            color: #1e40af !important;
        }

        .navbar {
            /* margin: 15px; */
            padding: 15px 30px;
        }

        /* new update */
        .validation-table {
            width: 700px;
            border-collapse: collapse;
            font-family: Arial, sans-serif;
        }

        .validation-table th,
        .validation-table td {
            border: 1px solid #000;
            padding: 10px;
            text-align: center;
        }

        .validation-table td a {
            color: #007bff;
            text-decoration: underline;
        }

        .input-disabled {
            width: 100%;
            padding: 6px;
            border: 1px solid #aaa;
            border-radius: 6px;
            background-color: #eee;
        }

        .link-select {
            width: 100%;
            padding: 6px;
            border: 1px solid #aaa;
            border-radius: 6px;
        }

        .valid {
            color: green;
            font-weight: bold;
        }

        .invalid {
            color: red;
            font-weight: bold;
        }

        .confirm-btn {
            padding: 8px 16px;
            background-color: #2f80ed;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .confirm-btn:hover {
            background-color: #1f5fc4;
        }

        .nav-buttons {
            max-width: 700px;
            margin: 20px auto;
        }

        .table-scroll-container {
            max-height: 300px;
            overflow-y: auto;
            overflow-x: hidden;
            border: 1px solid #ccc;
            border-radius: 6px;
        }

        /* ƒê·∫£m b·∫£o table kh√¥ng b·ªã co l·∫°i */
        .validation-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        .validation-table th,
        .validation-table td {
            padding: 10px;
            border: 1px solid #ccc;
            text-align: left;
        }

        /* C·ªë ƒë·ªãnh header */
        .validation-table thead th {
            position: sticky;
            top: 0;
            background-color: #f8f9fc;
            z-index: 2;
        }

        .validation-table th:first-child,
        .validation-table td:first-child {
            width: 35px;
            /* ho·∫∑c nh·ªè h∆°n n·ªØa n·∫øu b·∫°n mu·ªën */
            max-width: 35px;
            text-align: center;
        }

        .validation-table th:nth-child(3),
        .validation-table td:nth-child(3) {
            width: 90px;
            /* ho·∫∑c nh·ªè h∆°n n·ªØa n·∫øu b·∫°n mu·ªën */
            max-width: 90px;
            text-align: center;
        }


        .confirm-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        /* uploaded document */
        .uploaded-documents {
            font-family: Arial, sans-serif;
            margin-top: 1rem;
        }

        .uploaded-documents h3 {
            font-weight: bold;
            font-size: 20px;
            margin-bottom: 0.5rem;
        }

        .document-group {
            max-width: 300px;
        }

        .document-group details {
            margin-bottom: 0.8rem;
            border-left: 2px solid #ccc;
            padding-left: 10px;
        }

        .document-group summary {
            cursor: pointer;
            font-weight: bold;
            font-size: 17px;
            margin-bottom: 0.3rem;
        }

        .entity-list {
            list-style-type: disc;
            margin-left: 1.5rem;
            font-size: 17px;
            padding-left: 0;
        }

        .entity-list li {
            margin-bottom: 4px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="navbar">
            <div class="left">
                <a href="../templete/home.html">
                    <img src="../asserts/logo2.png" alt="SilverSea Logo" class="logo" />
                </a>
            </div>

            <div class="center">
                <a href="../templete/basic_info.html" class="nav-item">
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M5.121 17.804A6 6 0 0112 15a6 6 0 016.879 2.804M15 11a3 3 0 10-6 0 3 3 0 006 0z" />
                    </svg>
                    Basic Info
                </a>

                <a href="../templete/document.html" class="nav-item active">
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 8c-1.333 0-2 .667-2 2s.667 2 2 2 2 .667 2 2-.667 2-2 2m0-14c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8z" />
                    </svg>
                    Upload Document
                </a>

                <a href="../templete/upload_summary.html" class="nav-item ">
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3 10h18M3 6h18a2 2 0 012 2v8a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2z" />
                    </svg>
                    Summary
                </a>
            </div>

            <div class="right">
                <div class="client-meta">
                    <div class="client-details">
                        <div style="display: flex;">
                            <span class="client-line">
                                <i class="icon">üë§</i> <span class="label">Client:</span> <strong id="client-name">John
                                    Doe</strong>
                            </span>
                            <span class="client-line" style="margin-left: 30px;">
                                <span class="label">Return ID:</span> <strong id="client-line-returnID"></strong>
                            </span>
                        </div>
                        <span class="client-line">
                            <i class="icon">‚úâÔ∏è</i> <span class="label">Email:</span> <strong
                                id="primary-email"></strong>
                        </span>
                        <div class="client-status">
                            <span class="saved-time" id="saved-time">Not save</span>
                            <span class="attachment" id="attachment-count">üìé 0 Attachments</span>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- content -->
        <div class="income-container">

            <!-- <div class="detail-json-container">
                <div id="result-search-return-id">
                    <div id="result-buttons">
                        <button id="btn-download-json" type="button">Download JSON</button>
                        <button id="btn-show-json"  type="button">Show JSON</button>
                    </div>
                    <div id="result-overview" style="display: none;"></div>
                </div>
            </div> -->

            <div class="uploaded-documents">
                <h3>Uploaded Document</h3>

                <div class="document-group">
                    <!-- <details open>
                        <summary>ABC.PDF</summary>
                        <ul class="entity-list">
                            <li>W-2 - ABC, INC 2024</li>
                            <li>W-2 - XYZ, INC 2024</li>
                            <li>1099-INT - BANK OF AMERICA - 1111</li>
                        </ul>
                    </details>

                    <details open>
                        <summary>XYZ.PDF</summary>
                        <ul class="entity-list">
                            <li>W-2 - 123, INC 2024</li>
                            <li>1099-INT - BANK OF AMERICA - 2222</li>
                        </ul>
                    </details> -->
                </div>
            </div>

            <!-- Right panel: Upload UI -->
            <div class="upload-section">
                <h2>Upload all of your Tax Documents in PDF</h2>
                <div class="upload-box" id="uploadBox">
                    <label for="" id="label-tax-year">Tax year: 2025</label>
                    <input type="file" id="fileInput" />
                    <button class="note-button" id="uploadBtn">Upload</button>
                </div>

                <div class="table-scroll-container" id="table-scroll-container">
                    <table class="validation-table scrollable">
                        <thead>
                            <tr>
                                <th>Page</th>
                                <th>File</th>
                                <th>Form</th>
                                <th>Entity</th>
                                <th>Validation</th>
                                <th>Link</th>
                            </tr>
                        </thead>
                        <tbody id="table-body">
                        </tbody>
                    </table>
                </div>
                <!-- </div>  -->
                <div class="confirm-wrapper" style="text-align: right; margin-top: 20px;">
                    <button class="confirm-btn" id="confirm-btn">Confirm</button>
                </div>


            </div>

            <!-- Left panel: Last year info -->
            <div class="last-year-box">
                <p>‚ÄúHere's what you had last year:</p>
                <!-- <ul class="checklist">
                    
                </ul> -->
                <div class="reuslt-checklist-container1">
                    <!-- <div class="return-header-box" id="return-header-box"></div>  -->

                    <ul class="result_checklist1 checklist"></ul>
                    <span class="new-found-label1" style="display:none; font-weight:bold; margin-top:1rem;">new
                        found</span>
                    <ul class="result_checklist-new-found1 checklist"></ul>
                </div>

                <!-- <strong>Real Estate Sales</strong> -->
            </div>
        </div>

        <!-- Overlay checklist -->
        <div id="checklistOverlay" class="overlay hidden">
            <div class="checklist-container">
                <button id="closeOverlay" class="close-btn">‚úñ</button>
                <h2>Client Questionnaire</h2>
                <p>This questionnaire will guide you through all the info and documents we need from you.</p>

                <!-- Checklist render here -->
                <ul class="result_checklist"></ul>

                <button class="continue-btn">Continue ‚Üí</button>
                <a href="#" class="download-excel hidden" download>Download Excel</a>
            </div>
        </div>

        <!-- Loading indicator -->
        <div id="loading-overlay" class="loading-overlay" style="display: none;">
            <div class="spinner"></div>
        </div>

    </div>
    <!-- footer -->
    <div class="nav-buttons">
        <button type="button" onclick="history.back()">‚Üê Back</button>
        <button type="submit" id="btn-selected-checklist">Continue ‚Üí</button>
    </div>
    <script>
        document.addEventListener('keydown', function (event) {
            if (event.ctrlKey && event.key === 's') {
                save_attachments()
            }
        });

        function save_attachments() {
            var importedHistory = ''
            var importHistory = localStorage.getItem("importHistory");
            if (importHistory) {
                importedHistory = JSON.parse(importHistory);
            }
            console.log(importedHistory)
            var count = importedHistory.length
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            var import_time = `${hours}:${minutes}`
            if (count > 0) {
                // S·∫Øp x·∫øp theo th·ªùi gian gi·∫£m d·∫ßn
                importedHistory.sort((a, b) => new Date(b.imported_at) - new Date(a.imported_at));

                // L·∫•y record ƒë·∫ßu ti√™n (m·ªõi nh·∫•t)
                var latestImport = importedHistory[0];
                var latestTime = new Date(latestImport.imported_at);
                import_time = latestTime
                import_time = formatDate(import_time)
                console.log("Latest import time:", latestTime.toLocaleString());  // Hi·ªÉn th·ªã ƒë·ªãnh d·∫°ng d·ªÖ ƒë·ªçc
                console.log("Latest file:", latestImport.imported_json_url);     // C√≥ th·ªÉ d√πng t√™n file n·∫øu c·∫ßn
            }
            function formatDate(dateStr) {
                const date = new Date(dateStr);

                const MM = String(date.getMonth() + 1).padStart(2, '0');
                const DD = String(date.getDate()).padStart(2, '0');
                const YYYY = date.getFullYear();

                const HH = String(date.getHours()).padStart(2, '0');
                const mm = String(date.getMinutes()).padStart(2, '0');
                const SS = String(date.getSeconds()).padStart(2, '0');

                return `${MM}:${DD}:${YYYY} ${HH}:${mm}:${SS}`;
            }

            event.preventDefault(); // ch·∫∑n h√†nh vi l∆∞u trang m·∫∑c ƒë·ªãnh

            // C·∫≠p nh·∫≠t th·ªùi gian

            document.getElementById('saved-time').textContent = `‚úîÔ∏è Saved at ${import_time}`;

            // Gi·∫£ l·∫≠p tƒÉng attachment count
            const attachmentElement = document.getElementById('attachment-count');
            const currentCount = parseInt(attachmentElement.textContent.match(/\d+/)[0]);
            attachmentElement.textContent = `üìé ${count} Attachments`;
        }
        document.addEventListener('DOMContentLoaded', function () {
            save_attachments()
        })

    </script>
    <script type="module" src="../js/upload_document.js"></script>

</body>

</html>